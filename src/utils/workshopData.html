<html>
  <head>
    <title>Workshop Data</title>
    <link
      href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAliYAAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREAAAAAEREREQAAAAARAAAAAAAAABEAAAAAAAAAEQAAAAAAAAARAAAAAAAAABEAAAAAAAAAEQAAAAAAAAARAAAAAAAAABEAAAAAAAAAEQAAAAAAAAARERERAAAAAAEREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
      rel="icon"
      type="image/x-icon"
    />
    <style>
      .mainContainer > * {
        margin: 0;
        padding: 0;
      }
      .mainContainer {
        padding-block: 32px;
        padding-inline: 72px;
        display: flex;
        flex-direction: column;
        text-transform: capitalize;
      }
      .mainContainer > h2 {
        font-size: 40;
        font-weight: bold;
        color: rgba(0, 153, 0, 1);
      }
      .buttonContainer{
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .buttonContainer >h3 {
        color: rgba(102, 102, 102, 1);
        font-size: 28px;
        font-weight: 500;
      }
      .buttonContainer >#createCSVFile{
        text-decoration: none;
        color:rgba(0, 153, 0, 1);
        border: 1px solid rgba(0, 153, 0, 1);
        width:max-content;
        font-size:20px;
        text-align:center;
        padding: 0.5em 1em;
        border-radius: 5px;
        opacity: 0.9;
        transition: all 100ms ease-in;
      }
      .buttonContainer >#createCSVFile:hover{
        opacity: 1;
        transform:scale(1.1);
      }
      .dataGrid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        position: relative;
      }
      .dataGrid::before {
        content: "";
        position: absolute;
        top: 2.5%;
        left: 47.5%;
        height: 13%;
        width: 4px;
        background-color: rgba(229, 207, 0, 1);
      }
      .data {
        width: 90%;
        display: flex;
        justify-content: space-between;
      }
      .data.image {
        width: 100%;
        flex-direction: column;
        align-items: center;
        grid-column: 1/-1;
      }
      .dataName {
        font-size: 20px;
        font-weight: bold;
        color: rgba(51, 51, 51, 1);
      }
      .dataValue {
        font-size: 20px;
        font-weight: 400;
        color: rgba(102, 102, 102, 1);
      }
      .imageGrid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        width: 100%;
        gap: 2em;
      }
      .imageGrid > a {
        text-decoration: none;
        color: transparent;
        max-width: 100%;
      }
      .imageGrid > a > img,
      .imageGrid > a > video {
        display: block;
        max-width: 100%;
        aspect-ratio: 1/1;
        width: 200px;
        transition:filter 100ms ease-in;
      }
      .imageGrid > a > img:hover,
      .imageGrid > a > video:hover {
        filter: brightness(0.7);
      }
    </style>
  </head>
  <body>
    <div class="mainContainer">
      <h2>
        A new application for certification has been submitted by a workshop
      </h2>
      <div class="buttonContainer">
        <h3>here is the submitted information:</h3>
        <a id="createCSVFile" download="workshopData.csv">Download as CSV</a>
      </div>
      <div class="dataGrid" id="dataGrid"></div>
    </div>
    <script type="application/javascript">
      const fetchData = async () => {
        const res = await fetch(
          "http://localhost:3000/application/getUserApplication",
          {
            method: "GET",
            headers: {
              Authorization:"{{token}}"
            },
          }
        );
        const data = await res.json();
        const dataGrid = document.getElementById("dataGrid");
        for (let field in data.result) {
          if (field == "file_paths") {
            let div = document.createElement("div");
            div.classList.add("data");
            div.classList.add("image");
            let divImgGrid = document.createElement("div");
            divImgGrid.classList.add("imageGrid");
            JSON.parse(data.result[field]).forEach((file) => {
              let a = document.createElement("a");
              a.href = file;
              a.target = "_blank";
              if (file.search("mp4") !== -1) {
                let video = document.createElement("video");
                video.src = file;
                a.appendChild(video);
              } else {
                let img = document.createElement("img");
                img.src = file;
                a.appendChild(img);
              }
              divImgGrid.appendChild(a);
            });
            div.innerHTML = `
            <p class="dataName">
                Files Uploaded
            </p>`;
            div.appendChild(divImgGrid);
            dataGrid.appendChild(div);
            continue;
          }
          let div = document.createElement("div");
          div.classList.add("data");
          div.innerHTML = `
          <p class="dataName">${field}</p>
          <p class="dataValue">${data.result[field]}</p>`;
          dataGrid.appendChild(div);
        }
  
    const results = [data.result]
    const keys = Object.keys(results[0]);
    const commaSeparatedString = [keys.join(",") , results.map(row => keys.map(key => row[key]).join(",")).join("\n")].join("\n");
    const csvBlob = new Blob([commaSeparatedString]);
    const createCSVFile = document.getElementById("createCSVFile");
    createCSVFile.href = URL.createObjectURL(csvBlob);
      };
      fetchData();
    </script>
  </body>
</html>
